(function(d){var k=['<div class="ui-selectbox-container">','  <div class="ui-selectbox-select-item">',"    {select-item}","  </div>","</div>"].join("");var m=['<div class="ui-selectbox-list-container">',"  <iframe></iframe>",'  <div class="ui-selectbox-items">','    <div class="ui-selectbox-items-list">',"    <ul>","     {items}","    </ul>","    </div>","  </div>","</div>"].join("");var b=".ui-selectbox-selected";var f=".ui-selectbox-items-list";var c=".ui-selectbox-select-item a";var i=".ui-selectbox-single-item";var e=".ui-selectbox-list-open";var l=d(document);var j;var h=function(n){return n.replace(".","")};var g={maxItems:5};var a=function(o,n){this.selectField=o;this.options=n;o.data("selectBox",this);this.init()};a.prototype={init:function(){this.renderUI();this.bindEvent();setTimeout(d.proxy(function(){this.selectField.trigger("selectbox::init",this)},this),0)},renderUI:function(){var o=[],n="";d.each(this.selectField[0].options,function(p,r){var q="";if(r.selected){n='<a href="#" data-value="'+r.value+'" data-index="'+p+'">'+r.text+"</a>";q=' class="'+h(b)+'"'}o.push('<li><a href="#" data-value="'+r.value+'" data-index="'+p+'"'+q+">"+r.text+"</a></li>")});if(!this.options.width){this.options.width=this.selectField.width()}this.node=d(k.replace("{select-item}",n)).css("width",this.options.width).insertBefore(this.selectField);this.listContainer=d(m.replace("{items}",o.join(""))).appendTo("body");this.listContainer.css("width",this.options.width);this.selectField.hide();this.selectItem=this.node.find(c);this.list=this.listContainer.find(f);this.iframe=this.listContainer.find("iframe");if(o.length===1){this.selectItem.parent().addClass(h(i))}else{if(o.length>this.options.maxItems){this.list.css("height",this.options.maxItems*this.list.find("li").eq(0).height())}}this.iframe.css("height",this.list.height());this.listHide()},bindEvent:function(){this.selectItem.click(d.proxy(function(o){if(d(o.currentTarget).parent().hasClass(h(i))){o.preventDefault();return}var n=d(o.currentTarget);this.listContainer.toggle(0,d.proxy(function(){n.focus();this.list.scrollTop(this.list.data("pos"));this.updateListPosition();this.selectField.trigger("selectbox::focus",this)},this));n.toggleClass(h(e));return false},this)).keydown(d.proxy(this.handleKey,this));d(window).resize(d.proxy(function(){this.listHide()},this));this.list.delegate("a","click",d.proxy(function(n){this.setValueByIndex(d(n.currentTarget).data().index);this.listHide();return false},this));l.click(d.proxy(function(n){this.listHide()},this));this.selectField.bind("selectbox::change",function(o,n){n.instance.updateListPosition()})},handleKey:function(p){var o=this.selectItem.data();var q={key_38:function(){this.setValueByIndex(o.index-1)},key_40:function(){this.setValueByIndex(o.index+1)},key_13:function(){this.listHide()}};try{q["key_"+p.which].call(this)}catch(n){}return false},updateListPosition:function(){var n=this.node.offset();this.listContainer.css({left:n.left,top:n.top+this.node.height()})},setValueByIndex:function(p){var q=this.selectField[0].options[p];if(!q){return}q.selected=true;var o={index:p,value:q.value};var r=this.list.find("li:eq("+p+")");var n=r[0].offsetTop;this.list.find(b).removeClass(h(b));r.find("a").addClass(h(b));this.selectItem.data(o).text(q.text);if(n>this.list.height()){this.list.scrollTop(n*0.9);this.list.data("pos",n*0.9)}else{this.list.scrollTop(0);this.list.data("pos",0)}this.selectField.trigger("selectbox::change",{text:q.text,value:o.value,index:o.index,instance:this})},listHide:function(){this.listContainer.hide();this.selectItem.removeClass(h(e))},setValue:function(n){var p=this.selectField[0].options;var o=0;while(p[o]){if(p[o].value===n){break}o++}this.setValueByIndex(o)},getValue:function(){return(this.selectItem.data()).value},getText:function(){return this.selectItem.text()}};d.fn.selectBox=function(n){var o=d.extend(g,n||{});return this.each(function(){new a(d(this),o)})}})(jQuery);